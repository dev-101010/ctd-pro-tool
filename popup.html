<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>C-TD Upgrade Tool</title>
    <script src="https://www.c-td.de/assets/custom/socket.io.js"></script>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background-color: #121212;
            color: white;
        }

        .tab-menu {
            display: flex;
            background-color: #222;
        }

        .tab-menu button {
            flex: 1;
            padding: 12px;
            background-color: #333;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tab-menu button:hover,
        .tab-menu button.active {
            background-color: #444;
        }

        .tab-content {
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .xp-display {
            font-size: 18px;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        select, button {
            background-color: #333;
            color: white;
            border: 1px solid #555;
            padding: 5px 10px;
            cursor: pointer;
        }

        .skill-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .skill-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .skill-name {
            width: 100px;
        }

        .skill-boxes {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
        }

        .box {
            width: 12px;
            height: 12px;
            background-color: #444;
            border: 1px solid #666;
            cursor: pointer;
        }

        .box.active {
            background-color: limegreen;
        }
    </style>
</head>
<body>

<div class="tab-menu">
    <button class="tab-button active" onclick="showTab(0)">Upgrade</button>
    <button class="tab-button" onclick="showTab(1)">Tab 2</button>
    <button class="tab-button" onclick="showTab(2)">Tab 3</button>
</div>

<div class="tab-content active">
    <div class="header-bar">
        <div class="xp-display">XP: <span id="xpCounter">100</span></div>
        <div class="controls">
            <select id="profileSelect">
                <!-- Dynamisch befÃ¼llt -->
            </select>
            <button onclick="newProfile()">âž•</button>
            <button onclick="saveProfile()">ðŸ’¾</button>
        </div>
    </div>

    <div class="skill-container" id="skillContainer">
        <!-- Dynamisch generierte Skills -->
    </div>
</div>

<div class="tab-content">
    <h2>Inhalt Tab 2</h2>
    <p>Hier steht der Inhalt des zweiten Tabs.</p>
</div>

<div class="tab-content">
    <h2>Inhalt Tab 3</h2>
    <p>Hier steht der Inhalt des dritten Tabs.</p>
</div>

<script>

    function showTab(index) {
        const buttons = document.querySelectorAll('.tab-button');
        const contents = document.querySelectorAll('.tab-content');

        buttons.forEach(btn => btn.classList.remove('active'));
        contents.forEach(content => content.classList.remove('active'));

        buttons[index].classList.add('active');
        contents[index].classList.add('active');
    }

    function socket(serverURI,userToken,authToken) {
        const socket = io(serverURI, {
            reconnection: true,
            reconnectionDelayMax: 1000,
            reconnectionAttempts: 0,
            pingTimeout: 20000,
            pingInterval: 25000,

            auth: {
                authToken: authToken
            }
        });

        window.addEventListener('beforeunload', () => {
            socket.disconnect();
        });

        socket.onAny((event, ...args) => {
            if (event !== "ding" && event !== "dong") {
                console.log(event,args);
            }
        });

        socket.on("connect", () => {
            socket.emit("authUser", {
                token: userToken
            });
            console.log("Connected");
        });

        socket.on("authSuccess", () => {
            socket.emit("setPage", {
                page: "battlefield"
            });
            console.log("Auth success");
        });
    }

    const skills = ['StÃ¤rke', 'Geschick', 'Intelligenz'];
    const skillData = [];
    const skillContainer = document.getElementById('skillContainer');

    function createSkillRow(skillName, skillIndex) {
        const row = document.createElement('div');
        row.className = 'skill-row';

        const label = document.createElement('div');
        label.className = 'skill-name';
        label.textContent = skillName;
        row.appendChild(label);

        const boxes = document.createElement('div');
        boxes.className = 'skill-boxes';

        for (let i = 0; i < 100; i++) {
            const box = document.createElement('div');
            box.className = 'box';
            box.dataset.index = i;
            box.dataset.skill = skillIndex;

            box.addEventListener('click', () => {
                // Nur eine Box pro Spalte aktiv
                document.querySelectorAll(`.box[data-index="${i}"]`).forEach(b => b.classList.remove('active'));
                box.classList.add('active');
            });

            boxes.appendChild(box);
        }

        row.appendChild(boxes);
        skillContainer.appendChild(row);
    }

    // Initiales Rendering
    skills.forEach((name, idx) => {
        createSkillRow(name, idx);
    });

    function newProfile() {
        const name = prompt("Profilname?");
        if (name) {
            const option = document.createElement('option');
            option.textContent = name;
            document.getElementById('profileSelect').appendChild(option);
        }
    }

    function saveProfile() {
        alert("Profil gespeichert (Demo-Funktion).");
        // Hier kannst du spÃ¤ter die aktive Verteilung als JSON speichern oder Ã¤hnliches
    }

    window.addEventListener("load", () => {

        const authToken = window.opener?.sessionStorage.getItem("authToken");
        const userToken = window.opener?.sessionStorage.getItem("userToken");
        const serverURI = "wss://ctd.drochmann.de:8225";

        if (!userToken || !authToken) {
            console.log("Kein Token gefunden!");
            return;
        }

        socket(serverURI,userToken,authToken);

    });
</script>
</body>
</html>